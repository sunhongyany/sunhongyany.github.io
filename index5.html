<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <title>Stay hungry, stay foolish</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Stay hungry, stay foolish </a></h1>
                <nav><ul>
                    <li><a href="/archives.html">文章归档</a></li>
                    <li><a href="/category.html">文章分类</a></li>
                </ul></nav>
        </header><!-- /#banner -->

                <section id="content" class="body">
                    <ol id="posts-list" class="hfeed" start="2">
            <li><article class="hentry">
                <header>
                    <h1><a href="/yong-hu-yan-zheng.html" rel="bookmark"
                           title="Permalink to 用户验证">用户验证</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-09-04T20:30:00+08:00">
                Published: 一 04 九月 2017
        </abbr>


</footer><!-- /.post-info -->                <p>用户验证是指在收到用户请求后进行处理前先判断用户的认证状态（如登陆状态），若通过验证则正常处理，否则强制用户跳转至认证页面（如登陆页面）。</p>
<p>authenticated装饰器</p>
<p>为了使用Tornado的认证功能，我们需要对登录用户标记具体的处理函数。我们可以使用@tornado.web.authenticated装饰器完成它。当我们使用这个装饰器包裹一个处理方法时，Tornado将确保这个方法的主体只有在合法的用户被发现时才会调用。</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProfileHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@tornado.web.authenticated</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;这是我的个人主页。&quot;</span><span class="p">)</span>
<span class="n">get_current_user</span><span class="p">()</span><span class="err">方法</span>
</pre></div>


<p>装饰器@tornado.web.authenticated的判断执行依赖于请求处理类中的self.current_user属性，如果current_user值为假（None、False、0、""等），任何GET或HEAD请求都将把访客重定向到应用设置中login_url指定的URL，而非法用户的POST请求将返回一个带有403（Forbidden）状态的HTTP响应。</p>
<p>在获取self.current_user属性的时候，tornado会调用get_current_user()方法来返回current_user的值。也就是说，我们验证用户的逻辑应写在get_current_user()方法中，若该方法返回非假值则验证通过 …</p>
                <a class="readmore" href="/yong-hu-yan-zheng.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/cookie.html" rel="bookmark"
                           title="Permalink to cookie">cookie</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-08-27T20:30:00+08:00">
                Published: 日 27 八月 2017
        </abbr>


</footer><!-- /.post-info -->                <p>设置</p>
<p>set_cookie(name, value, domain=None, expires=None, path='/', expires_days=None)</p>
<p>参数说明：</p>
<p>参数名             说明</p>
<p>name            cookie名</p>
<p>value           cookie值</p>
<p>domain          提交cookie时匹配的域名</p>
<p>path            提交cookie时匹配的路径</p>
<p>expires         cookie的有效期，可以是时间戳整数、时间元组或者datetime类型，为UTC时间</p>
<p>expires_days    cookie的有效期，天数，优先级低于expires</p>
<p>获取</p>
<p>get_cookie(name, default=None)</p>
<p>获取名为name的cookie，可以设置默认值。</p>
<p>清除</p>
<p>clear_cookie(name, path='/', domain=None)</p>
<p>删除名为name，并同时匹配domain和path的cookie。</p>
<p>clear_all_cookies(path='/', domain=None …</p>
                <a class="readmore" href="/cookie.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/jie-kou-yu-diao-yong-shun-xu.html" rel="bookmark"
                           title="Permalink to 接口与调用顺序">接口与调用顺序</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-08-27T20:30:00+08:00">
                Published: 日 27 八月 2017
        </abbr>


</footer><!-- /.post-info -->                <ol>
<li>initialize()</li>
</ol>
<p>对应每个请求的处理类Handler在构造一个实例后首先执行initialize()方法。路由映射中的第三个字典型参数会作为该方法的命名参数传递，如：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProfileHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/user/(.*)&#39;</span><span class="p">,</span> <span class="n">ProfileHandler</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)),</span>
    <span class="p">])</span>
</pre></div>


<ol>
<li>prepare()</li>
</ol>
<p>预处理，即在执行对应请求方式的HTTP方法（如get、post等）前先执行，注意：不论以何种HTTP方式请求，都会执行prepare()方法。</p>
<ol>
<li>
<p>HTTP方法</p>
<p>get      请求指定的页面信息，并返回实体主体。</p>
<p>head     类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头</p>
<p>post     向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。</p>
<p>POST请求可能会导致新的资源的建立和/或已有资源的修改 …</p></li></ol>
                <a class="readmore" href="/jie-kou-yu-diao-yong-shun-xu.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
        <a href="/index4.html">&laquo;</a>
    Page 5 / 18
        <a href="/index6.html">&raquo;</a>
</p>
                </section><!-- /#content -->
        <section id="extras" class="body">
        </section><!-- /#extras -->

</body>
</html>